<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
<!-- 下拉框 -->
<link rel="stylesheet" th:href="@{/ace/css/chosen.css}" />
<dif th:include="system/index/top::tophead"></dif>
<!-- 日期框 -->
<link rel="stylesheet" th:href="@{/ace/css/datepicker.css}" />
<link rel="stylesheet" th:href="@{/ace/css/bootstrap-multiselect.css}" />
</head>
<body class="no-skin">
	<!-- /section:basics/navbar.layout -->
	<div class="main-container" id="main-container">
		<!-- /section:basics/sidebar -->
		<div class="main-content">
			<div class="main-content-inner">
				<div class="page-content">
					<div class="row">
						<div class="col-xs-12 col-xs-offset-0">
							<form th:action="@{'/rule/basicpoints'+${action}}" name="Form"
								id="Form" method="post">
								<input type="hidden" name="ID" id="ID"
									th:value="${basicpoints == null ? '' : basicpoints.ID}" />
								<div id="zhongxin" style="padding-top: 13px;"></div>

								<div class="span12">
									<div class="widget-box">
										<div
											class="widget-header widget-header-blue widget-header-flat wi1dget-header-large">
											<h4 class="lighter">活动管理</h4>
										</div>
										<div class="widget-body">
											<div class="widget-main">
												<table id="table_report"
													class="table table-striped table-bordered table-hover">
													<tr>
														<td
															style="text-align: right; padding-top: 13px; width: 100px;">商城编码:</td>
														<td><input type="text" name="SHOP_CODE"
															id="SHOP_CODE"
															th:value="${basicpoints == null ? SHOP_CODE : basicpoints.SHOP_CODE}"
															style="width: 98%;" readonly="readonly"/></td>
														<td
															style="text-align: right; padding-top: 13px; width: 100px;">积分编码:</td>
														<td><input type="text" name="POINTS_CODE"
															id="POINTS_CODE"
															th:value="${basicpoints == null ? '' : basicpoints.POINTS_CODE}"
															style="width: 98%;" /></td>
														<td
															style="text-align: right; padding-top: 13px; width: 100px;">积分名称:</td>
														<td><input type="text" name="POINTS_NAME"
															id="POINTS_NAME"
															th:value="${basicpoints == null ? '' : basicpoints.POINTS_NAME}"
															style="width: 98%;" /></td>
													</tr>
													<tr>
														<td style="text-align: right; padding-top: 13px;">积分使用范围:</td>
														<td>
														<select class="chosen-select form-control"
															name="POINTS_RANGE" id="POINTS_RANGE"
															data-placeholder="积分使用范围" style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${pointsrangeList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.POINTS_RANGE)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select>
														</td>
														<td style="text-align: right; padding-top: 13px;">积分类型:</td>
														<td><select class="chosen-select form-control"
															name="POINTS_TYPE" id="POINTS_TYPE"
															data-placeholder="积分类型" style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${pointstypeList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.POINTS_TYPE)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select></td>
														<td style="text-align: right; padding-top: 13px;">限额类型:</td>
														<td><select class="chosen-select form-control"
															name="LIMIT_TYPE" id="LIMIT_TYPE" data-placeholder="限额类型"
															style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${limittypeList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.LIMIT_TYPE)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select></td>
													</tr>
													<tr>
														<td style="text-align: right; padding-top: 13px;">长期有效标志:</td>
														<td><select class="chosen-select form-control"
															name="LONGTIME_FLAG" id="LONGTIME_FLAG"
															data-placeholder="长期有效标志" style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${longtimeflagList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.LONGTIME_FLAG)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select></td>
														<td style="text-align: right; padding-top: 13px;">积分获得者:</td>
														<td><select class="chosen-select form-control"
															name="OWNER" id="OWNER" data-placeholder="积分获得者"
															style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${ownerList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.OWNER)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select></td>
														<td style="text-align: right; padding-top: 13px;">计算方式:</td>
														<td><select class="chosen-select form-control"
															name="RUN_FLAG" id="RUN_FLAG" data-placeholder="计算方式"
															style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${runflagList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.RUN_FLAG)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select></td>
													</tr>
													<tr>
														<td style="text-align: right; padding-top: 13px;">状态:</td>
														<td><select class="chosen-select form-control"
															name="STATUS" id="STATUS" data-placeholder="状态"
															style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${statusList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.STATUS)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select></td>
														<td style="text-align: right; padding-top: 13px;">起始日期:</td>
														<td>
														<input class="span10 date-picker" type="text" name="POINTS_STDATE"
															id="POINTS_STDATE"
															th:value="${basicpoints == null ? '' : basicpoints.POINTS_STDATE}"
															style="width: 98%;" /></td>
														<td style="text-align: right; padding-top: 13px;">终止日期:</td>
														<td><input class="span10 date-picker" type="text" name="POINTS_ENDATE"
															id="POINTS_ENDATE"
															th:value="${basicpoints == null ? '' : basicpoints.POINTS_ENDATE}"
															style="width: 98%;" /></td>
													</tr>
													<tr>
														<td style="text-align: right; padding-top: 13px;">类型:</td>
														<td><select class="chosen-select form-control"
															name="TYPE" id="TYPE" data-placeholder="类型"
															style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${typeList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.TYPE)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select></td>
														<td style="text-align: right; padding-top: 13px;">数据标志:</td>
														<td>
														<select class="chosen-select form-control"
															name="DATA_FLAG" id="DATA_FLAG" data-placeholder="数据标志"
															style="vertical-align: top;">
																<option value=""></option>
																<option th:each="item,status : ${dataflagList}"
																	th:selected="${item.BIANMA == (basicpoints == null ? '' : basicpoints.DATA_FLAG)}"
																	th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
														</select>
														</td>
														<td style="text-align: right; padding-top: 13px;">最大积分值:</td>
														<td><input type="number" name="MAX_POINTS"
															id="MAX_POINTS"
															th:value="${basicpoints == null ? '' : basicpoints.MAX_POINTS}"
															style="width: 98%;" /></td>
													</tr>
												</table>
											</div>
											<!--/widget-main-->
										</div>
										<!--/widget-body-->
									</div>
								</div>

								<div id="zhongxin2" class="center" style="display: none">
									<br /> <br /> <br /> <br /> <br /> <img
										th:src="@{/images/jiazai.gif}" /><br />
									<h4 class="lighter block green">提交中...</h4>
								</div>
							</form>
						</div>
						<!-- /.col -->
					</div>
					<!-- /.row -->
				</div>
				<!-- /.page-content -->
			</div>
		</div>
		<!-- /.main-content -->
	</div>
	<!-- /.main-container -->

	<footer>
		<div style="width: 100%; padding-bottom: 2px;" class="center">
			<a id="next" class="btn btn-sm btn-success" onclick="">下一步</a>
		</div>
	</footer>

	<!-- 页面底部js¨ -->
	<div th:include="system/index/foot::footdiv" />
	<!-- 下拉框 -->
	<script th:src="@{/ace/js/chosen.jquery.js}"></script>
	<!--提示框-->
	<script type="text/javascript" th:src="@{/js/jquery.tips.js}"></script>
	<script th:src="@{/ace/js/ace/ace.widget-box.js}"></script>
	<script th:src="@{/ace/js/ace/ace.settings.js}"></script>
	<script th:src="@{/ace/js/ace/ace.settings-rtl.js}"></script>
	<script th:src="@{/ace/js/ace/ace.settings-skin.js}"></script>
	<script th:src="@{/ace/js/ace/ace.widget-on-reload.js}"></script>
	<!-- 日期框 -->
	<script th:src="@{/ace/js/date-time/bootstrap-datepicker.js}"></script>
	<script th:src="@{/ace/js/bootstrap-multiselect.js}"></script>
	<script type="text/javascript" th:inline="javascript">
		$(top.hangge());
		var action = [[${action}]];		
		
		function cancel(){
			/*<![CDATA[*/
			top.jzts();
			if(true && document.forms[0]){
				var url = /*[[${url}]]*/;
				document.forms[0].action = url;
				document.forms[0].submit();
			}
			/*]]>*/		
		}
		
		//保存
		function save() {
			if ($("#SHOP_CODE").val() == "") {
				$("#SHOP_CODE").tips({
					side : 3,
					msg : '请输入商城编码',
					bg : '#AE81FF',
					time : 2
				});
				$("#SHOP_CODE").focus();
				return false;
			}
			if ($("#POINTS_CODE").val() == "") {
				$("#POINTS_CODE").tips({
					side : 3,
					msg : '请输入积分编码',
					bg : '#AE81FF',
					time : 2
				});
				$("#POINTS_CODE").focus();
				return false;
			}
			if ($("#POINTS_NAME").val() == "") {
				$("#POINTS_NAME").tips({
					side : 3,
					msg : '请输入积分名称',
					bg : '#AE81FF',
					time : 2
				});
				$("#POINTS_NAME").focus();
				return false;
			}
			if ($("#POINTS_RANGE").val() == "") {
				$("#POINTS_RANGE").tips({
					side : 3,
					msg : '请输入积分使用范围',
					bg : '#AE81FF',
					time : 2
				});
				$("#POINTS_RANGE").focus();
				return false;
			}
			if ($("#POINTS_TYPE").val() == "") {
				$("#pointsType").tips({
					side : 3,
					msg : '请输入积分类型',
					bg : '#AE81FF',
					time : 2
				});
				$("#POINTS_TYPE").focus();
				return false;
			}
			if ($("#LONGTIME_FLAG").val() == "") {
				$("#longtimeFlag").tips({
					side : 3,
					msg : '请输入长期有效标志',
					bg : '#AE81FF',
					time : 2
				});
				$("#LONGTIME_FLAG").focus();
				return false;
			}
			if ($("#OWNER").val() == "") {
				$("#ownerId").tips({
					side : 3,
					msg : '请输入积分获得者',
					bg : '#AE81FF',
					time : 2
				});
				$("#OWNER").focus();
				return false;
			}
			if ($("#RUN_FLAG").val() == "") {
				$("#runFlag").tips({
					side : 3,
					msg : '请输入计算方式',
					bg : '#AE81FF',
					time : 2
				});
				$("#RUN_FLAG").focus();
				return false;
			}
			if ($("#STATUS").val() == "") {
				$("#statusId").tips({
					side : 3,
					msg : '请输入状态',
					bg : '#AE81FF',
					time : 2
				});
				$("#STATUS").focus();
				return false;
			}
			if($("#LONGTIME_FLAG").val() != '0'){
				if ($("#POINTS_STDATE").val() == "") {
					$("#POINTS_STDATE").tips({
						side : 3,
						msg : '请输入起始日期',
						bg : '#AE81FF',
						time : 2
					});
					$("#POINTS_STDATE").focus();
					return false;
				}
				if ($("#POINTS_ENDATE").val() == "") {
					$("#POINTS_ENDATE").tips({
						side : 3,
						msg : '请输入终止日期',
						bg : '#AE81FF',
						time : 2
					});
					$("#POINTS_ENDATE").focus();
					return false;
				}
			}
			if ($("#TYPE").val() == "") {
				$("#TYPE").tips({
					side : 3,
					msg : '请输入类型',
					bg : '#AE81FF',
					time : 2
				});
				$("#DATA_FLAG").focus();
				return false;
			}
			if ($("#DATA_FLAG").val() == "") {
				$("#DATA_FLAG").tips({
					side : 3,
					msg : '请输入数据标志',
					bg : '#AE81FF',
					time : 2
				});
				$("#DATA_FLAG").focus();
				return false;
			}
			if ($("#BASE_RULE_NAME").val() == "") {
				$("#BASE_RULE_NAME").tips({
					side : 3,
					msg : '请输入规则名称',
					bg : '#AE81FF',
					time : 2
				});
				$("#BASE_RULE_NAME").focus();
				return false;
			}
			if ($("#BASE_STATUS").val() == "") {
				$("#BASE_STATUS").tips({
					side : 3,
					msg : '请选择状态',
					bg : '#AE81FF',
					time : 2
				});
				$("#BASE_STATUS").focus();
				return false;
			}
			if ($("#ATTACH_RULE_NAME").val() == "") {
				$("#ATTACH_RULE_NAME").tips({
					side : 3,
					msg : '请输入规则名称',
					bg : '#AE81FF',
					time : 2
				});
				$("#ATTACH_RULE_NAME").focus();
				return false;
			}
			if ($("#ATTACH_STATUS").val() == "") {
				$("#ATTACH_STATUS").tips({
					side : 3,
					msg : '请选择状态',
					bg : '#AE81FF',
					time : 2
				});
				$("#ATTACH_STATUS").focus();
				return false;
			}
			
			
			/*基本规则*/
			$("#base_rule_table tr[name='baseSelect']").each(function(){
				var selectVal = $(this).find("input[name='selectVal']").val();
				var funValue = $(this).find("[name='funValue']").val();
				var valValue = $(this).find("[name='valValue']").val();
				var value = selectVal + ",kbky," + funValue + ",kbky," + valValue; 
				var tableValue = $("#baseRuleTableValue").val();
				if(tableValue == ""){
					tableValue = value;
				}else{
					tableValue += ',ykbk,' + value;
				}
				$("#baseRuleTableValue").val(tableValue);
			});
			/*计算规则*/
			var calTxt = "";
			$("#calRuleDiv table[name='cal_rule_table']").each(function(){
				var calRuleCode = $(this).find("input[name='CAL_RULE_CODE']").val();
				var calRuleName = $(this).find("input[name='CAL_RULE_NAME']").val();
				var calStatus = $(this).find("select[name='CAL_STATUS']").val();
				var calRuleFormula = $(this).find("input[name='CAL_RULE_FORMULA']").val();
				var calFormulaType = $(this).find("select[name='CAL_FORMULA_TYPE']").val();
				//var calSelect = $(this).find("select[name='CAL_RULE_SELECT']").next().val();
				var tableValue = "";
				$(this).find("tr[name='calSelect']").each(function(){
					var selectVal = $(this).find("input[name='selectVal']").val();
					var funValue = $(this).find("[name='funValue']").val();
					var valValue = $(this).find("[name='valValue']").val();
					var value = selectVal + ",kbky," + funValue + ",kbky," + valValue; 
					//tableValue = $("#baseRuleTableValue").val();
					if(tableValue == ""){
						tableValue = value;
					}else{
						tableValue += ',ykbk,' + value;
					}
				});
				var calTableTxt = calRuleCode+",zyx,"+calRuleName+",zyx,"+calStatus+",zyx,"+
					calRuleFormula+",zyx,"+calFormulaType+",zyx,"+tableValue;
				if(calTxt == ""){
					calTxt = calTableTxt;
				}else{
					calTxt += ',xyz,' + calTableTxt;
				}
				$("#calTableTxt").val(calTxt);
			});
			
			$.post(/*[[@{'/rule/basicpoints'+${action}}]]*/,$("#Form").serializeJSON(),function(data){
				if(data == 'SUCCESS'){
					cancel();
				}else{
					alert(data);
				}
			}); 
		}
		$(function(){
			//日期框
			$('.date-picker').datepicker({
				autoclose : true,
				todayHighlight : true
			});
			$("#LONGTIME_FLAG").on('change', function(e, params){
				if(params == undefined){
					$("#POINTS_STDATE").attr("disabled",false);
					$("#POINTS_ENDATE").attr("disabled",false);
				}else if(params.selected == 0){
					$("#POINTS_STDATE").val('');
					$("#POINTS_ENDATE").val('');
					$("#POINTS_STDATE").attr("disabled",true);
					$("#POINTS_ENDATE").attr("disabled",true);
				}else{
					$("#POINTS_STDATE").attr('disabled', false);
					$("#POINTS_ENDATE").attr("disabled",false);
				}
			});			
			$('#BASE_RULE_SELECT').on('change',function(e, params) {
				$("#BASE_RULE_SELECT_TXT").val($("#BASE_RULE_SELECT").val());
				//selected、deselected
				if (params.selected == undefined) {
					var deselected = params.deselected;
					$("#base" + deselected).remove();
				} else {
					var selected = params.selected;
					getRuleHtml(selected,function(data){
						var progKey = selected.split("--");
						var prog = progKey[1];
						$("#base_rule_table").append(data);
						if(prog == '4' || prog == '41'){
							//$('.multiselect').multiselect({
							$('#'+selected+'_FUN').multiselect({
								 enableFiltering: true,
								 buttonClass: 'btn btn-white btn-primary',
								 templates: {
									button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"></button>',
									ul: '<ul class="multiselect-container dropdown-menu"></ul>',
									filter: '<li class="multiselect-item filter"><div class="input-group"><span class="input-group-addon"><i class="fa fa-search"></i></span><input class="form-control multiselect-search" type="text"/></div></li>',
									filterClearBtn: '<span class="input-group-btn"><button class="btn btn-default btn-white btn-grey multiselect-clear-filter" type="button"><i class="fa fa-times-circle red2"></i></button></span>',
									li: '<li><a href="javascript:void(0);"><label></label></a></li>',
									divider: '<li class="multiselect-item divider"></li>',
									liGroup: '<li class="multiselect-item group"><label class="multiselect-group"></label></li>'
								 }
							});
						}else{
							//下拉框
							initSelectOptions();
						}
					});
				}
			});
					
			$("#addCalRule").on("click", function() {
				$.post(/*[[@{/rule/getCalHtml}]]*/,{},function(data){
					$("#calRuleDiv").append(data);
					initSelectOptions();
					calRuleDiv();
				});
				return;
				//下拉框
				initSelectOptions();
			});
			
			calRuleDiv();
			
			$('.multiselect').multiselect({
				 enableFiltering: true,
				 buttonClass: 'btn btn-white btn-primary',
				 templates: {
					button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"></button>',
					ul: '<ul class="multiselect-container dropdown-menu"></ul>',
					filter: '<li class="multiselect-item filter"><div class="input-group"><span class="input-group-addon"><i class="fa fa-search"></i></span><input class="form-control multiselect-search" type="text"/></div></li>',
					filterClearBtn: '<span class="input-group-btn"><button class="btn btn-default btn-white btn-grey multiselect-clear-filter" type="button"><i class="fa fa-times-circle red2"></i></button></span>',
					li: '<li><a href="javascript:void(0);"><label></label></a></li>',
					divider: '<li class="multiselect-item divider"></li>',
					liGroup: '<li class="multiselect-item group"><label class="multiselect-group"></label></li>'
				 }
			});				
			//下拉框
			initSelectOptions();
		});
		//添加计算规则事件
		function calRuleDiv(){
			$("#calRuleDiv").find("select[name='CAL_RULE_SELECT']").off('change');
			$("#calRuleDiv").find("select[name='CAL_RULE_SELECT']").on('change', function(e, params){
				$(this).next().val($(this).val());
				var $this = $(this);
				if (params.selected == undefined) {
					var deselected = params.deselected;
					$this.parent().parent().parent().find("#cal" + deselected).remove();
				} else {
					var selected = params.selected;
					getCalRuleHtml(selected,function(data){
						var progKey = selected.split("--");
						var prog = progKey[1];
						$this.parent().parent().parent().append(data);
						if(prog == '4' || prog == '41'){
							$this.parent().parent().parent().find('#'+selected+'_FUN').multiselect({
								 enableFiltering: true,
								 buttonClass: 'btn btn-white btn-primary',
								 templates: {
									button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"></button>',
									ul: '<ul class="multiselect-container dropdown-menu"></ul>',
									filter: '<li class="multiselect-item filter"><div class="input-group"><span class="input-group-addon"><i class="fa fa-search"></i></span><input class="form-control multiselect-search" type="text"/></div></li>',
									filterClearBtn: '<span class="input-group-btn"><button class="btn btn-default btn-white btn-grey multiselect-clear-filter" type="button"><i class="fa fa-times-circle red2"></i></button></span>',
									li: '<li><a href="javascript:void(0);"><label></label></a></li>',
									divider: '<li class="multiselect-item divider"></li>',
									liGroup: '<li class="multiselect-item group"><label class="multiselect-group"></label></li>'
								 }
							});
						}else{
							//下拉框
							initSelectOptions();
						}
					});
				}
			});
		}
		function initSelectOptions(){
			//下拉框
			if (!ace.vars['touch']) {
				$('.chosen-select').chosen({
					allow_single_deselect : true
				});
				$(window).off('resize.chosen').on('resize.chosen', function() {
					$('.chosen-select').each(function() {
						var $this = $(this);
						$this.next().css({
							'width' : $this.parent().width()
						});
					});
				}).trigger('resize.chosen');
				$(document).on('settings.ace.chosen',
						function(e, event_name, event_val) {
							if (event_name != 'sidebar_collapsed')
								return;
							$('.chosen-select').each(function() {
								var $this = $(this);
								$this.next().css({
									'width' : $this.parent().width()
								});
							});
						});
				$('#chosen-multiple-style .btn').on(
						'click',
						function(e) {
							var target = $(this).find('input[type=radio]');
							var which = parseInt(target.val());
							if (which == 2)
								$('#form-field-select-4').addClass(
										'tag-input-style');
							else
								$('#form-field-select-4').removeClass(
										'tag-input-style');
						});
			}
		}
		function getRuleHtml(selected,callback){
			var progKey = selected.split("--");
			var index = progKey[1];
			$.ajax({
				type: "POST",
				url: /*[[@{/rule/findProgDesc}]]*/,
		    	data: {RULEITEM_CODE:progKey[0]},
				dataType:'json',
				cache: false,
				success: function(data){
					var prog = data.RULEITEM_PROG;
					var mapList = data.PROG_DESC;
					var text = data.RULEITEM_DESC;
					if(prog == '1'){
						var resHtml = '<tr id="base'+selected+'" name="baseSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td>'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="状态" style="vertical-align:top;">'
						+ '<option value="0">等于</option>'
						+ '<option value="1">不等于</option>'
						+ '<option value="2">属于</option>'
						+ '<option value="3">不属于</option>'
						+ '<option value="4">大于</option>'
						+ '<option value="5">小于</option>'
						+ '<option value="6">大于等于</option>'
						+ '<option value="7">小于等于</option>'
						+ '</select>'
						+ '</td>'
						+ '<td colspan="4"><input type="text" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/></td>'
						+ '</tr>';
					}
					if(prog == '2'){
						var resHtml = '<tr id="base'+selected+'" name="baseSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="5">'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="" style="vertical-align:top;">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '<input type="hidden" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/>';
						resHtml += '</td>';
						resHtml += '</tr>';
					}
					if(prog == '3'){
						var resHtml = '<tr id="base'+selected+'" name="baseSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="5">'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="" style="vertical-align:top;">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '<input type="hidden" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/>';
						resHtml += '</td>';
						resHtml += '</tr>';
					}
					if(prog == '4'){
						var resHtml = '<tr id="base'+selected+'" name="baseSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="5">'
						+ '<select class="multiselect" multiple="" name="funValue" id="'+selected+'_FUN">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '<input type="hidden" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/>';
						resHtml += '</td>';
						resHtml += '</tr>';
					}
					if(prog == '21'){
						var resHtml = '<tr id="base'+selected+'" name="baseSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="2">'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="状态" style="vertical-align:top;">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '</td>';
						resHtml += '<td colspan="3"><input type="text" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/></td>';
						resHtml += '</tr>';
					}
					if(prog == '31'){
						var resHtml = '<tr id="base'+selected+'" name="baseSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="2">'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="状态" style="vertical-align:top;">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '</td>';
						resHtml += '<td colspan="3"><input type="text" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/></td>';
						resHtml += '</tr>';
					}
					if(prog == '41'){
						var resHtml = '<tr id="base'+selected+'" name="baseSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="2">'
						+ '<select class="multiselect" multiple="" name="funValue" id="'+selected+'_FUN">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '</td>';
						resHtml += '<td colspan="3"><input type="text" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/></td>';
						resHtml += '</tr>';
					}
					callback(resHtml);
				}
			});
		}
		function getCalRuleHtml(selected,callback){
			var progKey = selected.split("--");
			var index = progKey[1];
			$.ajax({
				type: "POST",
				url: /*[[@{/rule/findProgDesc}]]*/,
		    	data: {RULEITEM_CODE:progKey[0]},
				dataType:'json',
				cache: false,
				success: function(data){
					var prog = data.RULEITEM_PROG;
					var mapList = data.PROG_DESC;
					var text = data.RULEITEM_DESC;
					if(prog == '1'){
						var resHtml = '<tr id="cal'+selected+'" name="calSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td>'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="状态" style="vertical-align:top;">'
						+ '<option value="0">等于</option>'
						+ '<option value="1">不等于</option>'
						+ '<option value="2">属于</option>'
						+ '<option value="3">不属于</option>'
						+ '<option value="4">大于</option>'
						+ '<option value="5">小于</option>'
						+ '<option value="6">大于等于</option>'
						+ '<option value="7">小于等于</option>'
						+ '</select>'
						+ '</td>'
						+ '<td colspan="4"><input type="text" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/></td>'
						+ '</tr>';
					}
					if(prog == '2'){
						var resHtml = '<tr id="cal'+selected+'" name="calSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="5">'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="" style="vertical-align:top;">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '<input type="hidden" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/>';
						resHtml += '</td>';
						resHtml += '</tr>';
					}
					if(prog == '3'){
						var resHtml = '<tr id="cal'+selected+'" name="calSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="5">'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="" style="vertical-align:top;">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '<input type="hidden" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/>';
						resHtml += '</td>';
						resHtml += '</tr>';
					}
					if(prog == '4'){
						var resHtml = '<tr id="cal'+selected+'" name="calSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="5">'
						+ '<select class="multiselect" multiple="" name="funValue" id="'+selected+'_FUN">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '</td>';
						resHtml += '<input type="hidden" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/>';
						resHtml += '</tr>';
					}
					if(prog == '21'){
						var resHtml = '<tr id="cal'+selected+'" name="calSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="2">'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="状态" style="vertical-align:top;">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '</td>';
						resHtml += '<td colspan="3"><input type="text" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/></td>';
						resHtml += '</tr>';
					}
					if(prog == '31'){
						var resHtml = '<tr id="cal'+selected+'" name="calSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="2">'
						+ '<select class="chosen-select form-control" name="funValue" id="'+selected+'_FUN" data-placeholder="状态" style="vertical-align:top;">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '</td>';
						resHtml += '<td colspan="3"><input type="text" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/></td>';
						resHtml += '</tr>';
					}
					if(prog == '41'){
						var resHtml = '<tr id="cal'+selected+'" name="calSelect">' 
						+ '<td style="width:75px;text-align: right;padding-top: 13px;">'
						+ text
						+ '<input type="hidden" name="selectVal" value="'+selected+'"/>'
						+ '</td>'
						+ '<td colspan="2">'
						+ '<select class="multiselect" multiple="" name="funValue" id="'+selected+'_FUN">';
						for(var key in mapList) { 
							resHtml += '<option value="'+key+'">'+mapList[key]+'</option>';
						}  
						resHtml += '</select>';
						resHtml += '</td>';
						resHtml += '<td colspan="3"><input type="text" name="valValue" id="'+selected+'_VAL" value="" maxlength="12" placeholder="" title="" style="width:98%;"/></td>';
						resHtml += '</tr>';
					}
					callback(resHtml);
				}
			});
		}
		
	</script>
</body>
</html>