<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
<!-- 下拉框 -->
<link rel="stylesheet" th:href="@{/ace/css/chosen.css}"/>
<dif th:include="system/index/top::tophead"></dif>
</head>
<body class="no-skin">
	<!-- /section:basics/navbar.layout -->
	<div class="main-container" id="main-container">
		<!-- /section:basics/sidebar -->
		<div class="main-content">
			<div class="main-content-inner">
				<div class="page-content">
					<div class="page-header">
							<h1>
								<small>
									<i class="ace-icon fa fa-angle-double-right"></i>
									编辑
								</small>
							</h1>
					</div><!-- /.page-header -->
					<div class="row">
						<div class="col-xs-8 col-xs-offset-2">

							<form th:action="@{'/rule/basicitem'+${action}}" name="Form" id="Form"
								method="post">
								<input type="hidden" name="ID" id="ID" th:value="${basicitem == null ? '' : basicitem.ID}" />
								<div id="zhongxin" style="padding-top: 13px;">
									<table id="table_report"
										class="table table-striped table-bordered table-hover">
										
										<tr>
											<td style="text-align: right; padding-top: 13px;">元素编码:</td>
											<td><input type="text" name="RULEITEM_CODE" id="RULEITEM_CODE"
												th:value="${basicitem == null ? '' : basicitem.RULEITEM_CODE}" style="width: 98%;" /></td>
											<td style="text-align: right; padding-top: 13px;">元素描述:</td>
											<td><input type="text" name="RULEITEM_DESC" id="RULEITEM_DESC"
												th:value="${basicitem == null ? '' : basicitem.RULEITEM_DESC}" style="width: 98%;" /></td>
										</tr>
										<tr>
											<td style="text-align: right; padding-top: 13px; ">元素对应数据表:</td>
											<td>
											<select
												class="chosen-select form-control" name="RULEITEM_TBL"
												id="RULEITEM_TBL" data-placeholder="元素对应数据表"
												style="vertical-align: top;">
													<option value=""></option>
													<option th:each="item,status : ${ruleitemtblList}" th:selected="${item.BIANMA == (basicitem == null ? '' : basicitem.RULEITEM_TBL)}" th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
												</select>
											</td>
											<td style="text-align: right; padding-top: 13px; ">元素对应字段名:</td>
											<td>
											<select
												class="chosen-select form-control" name="RULEITEM_COL"
												id="RULEITEM_COL" data-placeholder="元素对应字段名"
												style="vertical-align: top;">
													<option value=""></option>
													<option th:each="item,status : ${ruleitemcolList}" th:selected="${item.BIANMA == (basicitem == null ? '' : basicitem.RULEITEM_COL)}" th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
												</select>
											</td>
										</tr>
										<tr>
											<td style="text-align: right; padding-top: 13px; ">元素语法:</td>
											<td colspan="3">
											<select
												class="chosen-select form-control" name="RULEITEM_PROG"
												id="RULEITEM_PROG" data-placeholder="元素语法"
												style="vertical-align: top;">
													<option value=""></option>
													<option th:each="item,status : ${ruleitemprogList}" th:selected="${item.BIANMA == (basicitem == null ? '' : basicitem.RULEITEM_PROG)}" th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
												</select>
											  	<input id="btntext" type="button" value="添加语法值" data-toggle="modal" data-target="#myModal" />
											</td>
										</tr>
										<tr>
											<td style="text-align: right;padding-top: 13px;">语法值:</td>
											<td colspan="3">
											<input type="text" id="PROG_DESC" name="PROG_DESC" th:value="${basicitem == null ? '' : basicitem.PROG_DESC}" style="width:99%;"/>
											</td>
										</tr>
										<tr>
											<td style="text-align: right; padding-top: 13px; ">元素类型:</td>
											<td>
											<select
												class="chosen-select form-control" name="RULEITEM_TYPE"
												id="RULEITEM_TYPE" data-placeholder="元素类型"
												style="vertical-align: top;">
													<option value=""></option>
													<option th:each="item,status : ${ruleitemtypeList}" th:selected="${item.BIANMA == (basicitem == null ? '' : basicitem.RULEITEM_TYPE)}" th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
												</select>
											</td>
											<td style="text-align: right; padding-top: 13px; ">函数:</td>
											<td>
											<select
												class="chosen-select form-control" name="RULEITEM_FUN"
												id="RULEITEM_FUN" data-placeholder="函数"
												style="vertical-align: top;">
													<option value=""></option>
													<option th:each="item,status : ${ruleitemfunList}" th:selected="${item.BIANMA == (basicitem == null ? '' : basicitem.RULEITEM_FUN)}" th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
												</select>
											</td>
										</tr>
										<tr>
											<td style="text-align: right; padding-top: 13px; ">状态:</td>
											<td>
											<select
												class="chosen-select form-control" name="STATUS"
												id="STATUS" data-placeholder="状态"
												style="vertical-align: top;">
													<option value=""></option>
													<option th:each="item,status : ${statusList}" th:selected="${item.BIANMA == (basicitem == null ? '' : basicitem.STATUS)}" th:value="${item.BIANMA}" th:inline="text">[[${item.NAME}]]</option>
												</select>
											</td>
											<td style="text-align: right; padding-top: 13px;">默认值:</td>
											<td><input type="text" name="DEFAULT_VAL" id="DEFAULT_VAL"
												th:value="${basicitem == null ? '' : basicitem.DEFAULT_VAL}" style="width: 98%;" /></td>
										</tr>
										<tr>
											<td style="text-align: right; padding-top: 13px;">提示:</td>
											<td colspan="3"><input type="text" name="DEFAULT_DESC" id="DEFAULT_DESC"
												th:value="${basicitem == null ? '' : basicitem.DEFAULT_DESC}" style="width: 98%;" /></td>
										</tr>
									</table>
								</div>
								<div id="zhongxin2" class="center" style="display: none">
									<br />
									<br />
									<br />
									<br />
									<br />
									<img th:src="@{/images/jiazai.gif}" /><br />
									<h4 class="lighter block green">提交中...</h4>
								</div>
							</form>
						</div>
						<!-- /.col -->
					</div>
					<!-- /.row -->
				</div>
				<!-- /.page-content -->
			</div>
		</div>
		<!-- /.main-content -->
	</div>
	<!-- /.main-container -->

	<footer>
		<div style="width: 100%; padding-bottom: 2px;" class="center">
			<a class="btn btn-mini btn-primary" onclick="save();">保存</a> <a
				class="btn btn-mini btn-danger" onclick="cancel();">取消</a>
		</div>
	</footer>

<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					添加语法值
				</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
                            <label for="user_id" class="col-sm-3 control-label">值</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="elem_key" name="elem_key" value=""
                                       placeholder="请输入值"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="lastname" class="col-sm-3 control-label">名称</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="elem_value" value="" id="elem_value"
                                       placeholder="请输入名称"/>
                            </div>
                        </div>
			</div>
			<div class="modal-footer">
				<input type="button" class="btn btn-primary" data-dismiss="modal" value="确定" onclick="saveElemt()"/>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

	<!-- 页面底部js¨ -->
	<div th:include="system/index/foot::footdiv" />
	<!-- 下拉框 -->
	<script th:src="@{/ace/js/chosen.jquery.js}"></script>
	<!--提示框-->
	<script type="text/javascript" th:src="@{/js/jquery.tips.js}"></script>
	<script type="text/javascript" th:inline="javascript">
		$(top.hangge());
		var action = [[${action}]];		
		
		function cancel(){
			/*<![CDATA[*/
			top.jzts();
			if(true && document.forms[0]){
				var url = /*[[${url}]]*/;
				document.forms[0].action = url;
				document.forms[0].submit();
			}
			/*]]>*/		
		}
		
		//保存
		function save() {
			if ($("#RULEITEM_CODE").val() == "") {
				$("#RULEITEM_CODE").tips({
					side : 3,
					msg : '请输入元素编码',
					bg : '#AE81FF',
					time : 2
				});
				$("#RULEITEM_CODE").focus();
				return false;
			}
			if ($("#RULEITEM_DESC").val() == "") {
				$("#RULEITEM_DESC").tips({
					side : 3,
					msg : '请输入元素描述',
					bg : '#AE81FF',
					time : 2
				});
				$("#RULEITEM_DESC").focus();
				return false;
			}
			if ($("#DEFAULT_VAL").val() == "") {
				$("#DEFAULT_VAL").tips({
					side : 3,
					msg : '请输入默认值',
					bg : '#AE81FF',
					time : 2
				});
				$("#DEFAULT_VAL").focus();
				return false;
			}
			if ($("#DEFAULT_DESC").val() == "") {
				$("#DEFAULT_DESC").tips({
					side : 3,
					msg : '请输入提示',
					bg : '#AE81FF',
					time : 2
				});
				$("#DEFAULT_DESC").focus();
				return false;
			}
			$.post(/*[[@{'/rule/basicitem'+${action}}]]*/,$("#Form").serializeJSON(),function(data){
				if(data == 'SUCCESS'){
					cancel();
				}else{
					alert(data);
				}
			});
		}
		//清除弹窗原数据
		$("#myModal").on("hidden.bs.modal", function() {
		    $("#elem_key").val('');
		    $("#elem_value").val('');
		});
		
		function saveElemt(){
			var key = $("#elem_key").val();
			var value = $("#elem_value").val();
			var progDesc = $("#PROG_DESC").val();//eval('('+$("#PROG_DESC").val()+')');
			if(progDesc == ""){
				var desc = {};
				desc[key] = value;
				progDesc = desc;
				var str = JSON.stringify(progDesc);
				$("#PROG_DESC").val(str.replace(/"/g,"'"));
			}else{
				progDesc = eval('('+progDesc+')');
				progDesc[key] = value;
				var str = JSON.stringify(progDesc);
				$("#PROG_DESC").val(str.replace(/"/g,"'"));
			}
		}
		
		$(function(){
			$("#RULEITEM_TBL").on('change', function(e,params){
				$.post(/*[[@{/rule/basicitemGetCol}]]*/,{BIANMA:params.selected},function(data){
					var options = '';
		    		$.each(data, function(i, item){
		    			options += '<option value="'+item.BIANMA+'">'+item.NAME+'</option>';
		    		})
		    		$("#RULEITEM_COL").html(options);
		    		$("#RULEITEM_COL").trigger("chosen:updated");
				});
			});
			$("#RULEITEM_TYPE").on('change', function(e,params){
				if(params == undefined){
					$("#RULEITEM_FUN").val('');
					$("#RULEITEM_FUN").attr("disabled",true);
					$("#RULEITEM_FUN").trigger("chosen:updated");
				}
				if(params.selected == 2){
					$("#RULEITEM_FUN").removeAttr("disabled");
					$("#RULEITEM_FUN").trigger("chosen:updated");
				}else{
					$("#RULEITEM_FUN").val('');
					$("#RULEITEM_FUN").attr("disabled",true);
					$("#RULEITEM_FUN").trigger("chosen:updated");
				}
			});
			//下拉框
			if (!ace.vars['touch']) {
				$('.chosen-select').chosen({
					allow_single_deselect : true
				});
				$(window).off('resize.chosen').on('resize.chosen', function() {
					$('.chosen-select').each(function() {
						var $this = $(this);
						$this.next().css({
							'width' : $this.parent().width()
						});
					});
				}).trigger('resize.chosen');
				$(document).on('settings.ace.chosen',
						function(e, event_name, event_val) {
							if (event_name != 'sidebar_collapsed')
								return;
							$('.chosen-select').each(function() {
								var $this = $(this);
								$this.next().css({
									'width' : $this.parent().width()
								});
							});
						});
				$('#chosen-multiple-style .btn').on(
						'click',
						function(e) {
							var target = $(this).find('input[type=radio]');
							var which = parseInt(target.val());
							if (which == 2)
								$('#form-field-select-4').addClass(
										'tag-input-style');
							else
								$('#form-field-select-4').removeClass(
										'tag-input-style');
						});
			}
		});
	</script>
</body>
</html>